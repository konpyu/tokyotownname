.row
  .col-md-8
    / 画像を正方形の枠の中に収める。jsで抑えこむのがよさげ
    .hoge.ttn_photo_show_image(style="height:600px")
      = image_tag @photo.image.image_url

  .col-md-4
    %h3
      = "#{@photo.ward.name}#{@photo.town.name}"
    %p.text-muted
      = @photo.created_at.strftime("%Y/%m/%d %H:%M")
    %hr
    %h4 Reporter
    = image_tag @photo.user.authentication.image, class: "img-circle", style:"width:40px"
    = link_to "#{@photo.user.name}さん", user_path(@photo.user)


    %hr
    - if current_user.present?
      / TODO: helperize
      = form_tag toggle_lives_path, remote: true, method: :post, id: "ttn_lived", class: "show" do |f|
        = hidden_field_tag :livable_type, @photo.class.name
        = hidden_field_tag :livable_id, @photo.id
        = hidden_field_tag :kind, 'lived'

        / TODO: move to helper
        - submit_txt = Live.where(user: current_user, kind: 'lived', livable: @photo).present? ? 'やっぱ住んでない' : '住んでた'
        = submit_tag submit_txt, class: "btn btn-default"

    %hr
    %h5
      = @photo.comment
    %hr
    %strong#comment-count
      = "#{@photo.comments.count} comments"

    #comment-list
      - @photo.comments.each do |comment|
        %p
          %span.text-info
            = comment.user.name
          = comment.comment
          - if current_user.present? && current_user.id == comment.user_id
            = link_to "delete", comment_path(comment), class: "text-warning", method: :delete, data: { confirm: "消して大丈夫?" }
    .form-group
      = form_tag comments_path, remote: true, method: :post, id: "ttn_comment_form", class: "show" do |f|
        = text_field_tag :comment, nil, class: "form-control", placeholder: "コメントを追加", class: "show"
        = hidden_field_tag :commentable, @photo.class.name
        = hidden_field_tag :commentable_id, @photo.id
        = submit_tag "Submit!", class: "btn btn-default"


:javascript
  new Lives();
  new Comments();
